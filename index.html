
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flight Database V1</title>
  <style>
    body { font-family: sans-serif; }
    .tab { display: none; }
    .tab.active { display: block; }
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
    th { background: #ccc; }
    td button { margin-right: 4px; }
    input, select { margin: 3px; }
  </style>
</head>
<body>

<button onclick="switchTab('arrivals')">Arrivals</button>
<button onclick="switchTab('departures')">Departures</button>

<div id="arrivals" class="tab active">
  <h2>Arrivals</h2>
  <form id="arrivalForm">
    <input placeholder="Airline" name="airline">
    <input placeholder="Flight" name="flight">
    <input placeholder="From" name="from">
    <input placeholder="ICAO" name="icao">
    <input placeholder="Time" name="time" type="time">
    <input placeholder="Aircraft" name="aircraft">
    TPS: <input placeholder="TPS" name="tps" style="width:40px">
    <br>Days:
    <label><input type="checkbox" name="days" value="Mon">Mon</label>
    <label><input type="checkbox" name="days" value="Tue">Tue</label>
    <label><input type="checkbox" name="days" value="Wed">Wed</label>
    <label><input type="checkbox" name="days" value="Thu">Thu</label>
    <label><input type="checkbox" name="days" value="Fri">Fri</label>
    <label><input type="checkbox" name="days" value="Sat">Sat</label>
    <label><input type="checkbox" name="days" value="Sun">Sun</label>
    <br><button type="submit">Add Arrival</button>
  </form>
  <table id="arrivalTable">
    <thead>
      <tr><th>Airline</th><th>Flight</th><th>From</th><th>ICAO</th><th>Time</th><th>Aircraft</th><th>Days</th><th>TPS</th><th>Ações</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div id="departures" class="tab">
  <h2>Departures</h2>
  <table id="departureTable">
    <thead>
      <tr><th>Airline</th><th>Flight</th><th>To</th><th>ICAO</th><th>Time</th><th>Aircraft</th><th>Days</th><th>TPS</th><th>Excluir</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
function switchTab(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function serializeEntry(flight, icao, time) {
  return \`\${flight.trim().toUpperCase()}-\${icao.trim().toUpperCase()}-\${time}\`;
}

function getDaysString(form) {
  return [...form.querySelectorAll('input[name="days"]:checked')].map(d => d.value).join(', ');
}

function createArrivalRow(data) {
  const row = document.createElement('tr');
  const keys = ['airline', 'flight', 'from', 'icao', 'time', 'aircraft', 'days', 'tps'];
  keys.forEach(k => {
    const td = document.createElement('td');
    td.textContent = data[k];
    row.appendChild(td);
  });

  const tdActions = document.createElement('td');
  const btnDel = document.createElement('button');
  btnDel.textContent = 'X';
  btnDel.onclick = () => row.remove();

  const btnEdit = document.createElement('button');
  btnEdit.textContent = '✎';
  btnEdit.onclick = () => {
    const newVals = {};
    keys.forEach((k, i) => {
      newVals[k] = prompt(\`Editar \${k}:\`, row.children[i].textContent) || row.children[i].textContent;
    });
    keys.forEach((k, i) => {
      row.children[i].textContent = newVals[k];
    });

    // Atualizar também o Departure correspondente
    const depRows = document.querySelectorAll('#departureTable tbody tr');
    depRows.forEach(dr => {
      if (dr.children[1].textContent == (parseInt(data.flight)+1).toString().padStart(4,'0') ||
          dr.children[1].textContent == (parseInt(data.flight)-1).toString().padStart(4,'0')) {
        dr.children[0].textContent = newVals.airline;
        dr.children[2].textContent = newVals.from;
        dr.children[3].textContent = newVals.icao;
        dr.children[4].textContent = newVals.time;
        dr.children[5].textContent = newVals.aircraft;
        dr.children[6].textContent = newVals.days;
        dr.children[7].textContent = newVals.tps;
      }
    });
  };

  tdActions.appendChild(btnEdit);
  tdActions.appendChild(btnDel);
  row.appendChild(tdActions);
  return row;
}

document.getElementById('arrivalForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const data = {};
  this.querySelectorAll('input[name]').forEach(input => {
    if (input.type !== 'checkbox') data[input.name] = input.value.trim();
  });
  data.days = getDaysString(this);
  const row = createArrivalRow(data);
  document.querySelector('#arrivalTable tbody').appendChild(row);
  this.reset();
});
</script>
</body>
</html>
